version: '3.8'

services:
  # --- BACKEND DEV ---
  api:
    # Sobrescribimos el comando para usar el servidor de desarrollo
    command: php artisan serve --host=0.0.0.0 --port=8000
    volumes:
      - ./backend:/var/www/html       # <--- Espejo de tu código (NECESARIO)
      # TRUCO: Esto evita que tu carpeta local borre el vendor del contenedor
      # (Aunque en PHP lo ideal es correr 'composer install' localmente también)
      
    environment:
      APP_ENV: local
      APP_DEBUG: true

  # --- FRONTEND DEV ---
  frontend:
    command: npm run dev -- --host
    volumes:
      - ./frontend:/app               # <--- Espejo de tu código (NECESARIO)
      - /app/node_modules             # <--- TRUCO DE MAGIA: Esto protege la carpeta interna
    environment:
      - CHOKIDAR_USEPOLLING=true      # Ayuda con el hot-reload en Windows/WSL

  # --- AI WORKER DEV ---
  ai_worker:
    command: python src/worker_manager.py # O usar watchdog para auto-reload
    volumes:
      - ./ai_engine:/app              # <--- Espejo de tu código
    environment:
      PYTHONUNBUFFERED: 1



    